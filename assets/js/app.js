

//IMAGE LOADER////////////////////////
$('body').append('<div class="d-flex text-center loading-screen" id="loading-screen"><h1 class="font-size-h2 font-saira-semi-condensed color-tangerine">Loading Central Dispatch Touchscreen Experience...</h1><div class="loader">Loading...</div></div><div id="image-loader"><div id="preloader"><img src="assets/img/about-create-listings.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/about-dashboard.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/about-manage-dispatches.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/about-manage-listings.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/add-user.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/BTN-CORE.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/blind-ratings-modal-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/blind-ratings-modal-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/BTN-NAV-BLANK-HOVER.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/BTN-NAV-BLANK.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/BTN-START-BLANK.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_01.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_02.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_03.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_04.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_05.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_06.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_07.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_08.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS_09.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CALLOUTS3.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/carrier-app-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/carrier-app-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/carrier-app-3.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/carrier-verification-thumb.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/cd-nada-touchscreen-background.jpg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/cd-manheim-integration.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/Central_Dispatch_rgb_reverse.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/coming-soon-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/coming-soon-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/coming-soon-3.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/company-overview.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CORE-BG.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CORE.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/CP.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/dashboard-admin-panel.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_01.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_02.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_03.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_04.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_05.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_06.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_07.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_08.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/gold-list-item-core_09.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-clock.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-exit.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-menu.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-minus.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-plus.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-rotate.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-x-gold.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-x.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/icon-zoom.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_01.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_02.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_03.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_04.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_05.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_06.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_07.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_08.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/list-item-core_09.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/log-into-CD.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/manage-dispatches-modal.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/manage-dispatches-page.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/manage-listings-page-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/manage-listings-page-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/mann-listing-int-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/mann-listing-int-modal-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/mann-listing-int-modal-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/marketplace-intel-report-thumb-compressed.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/modal-market-intelligence.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/nav-arrow.svg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/ONE.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/poster.jpg" width="1" height="1" alt="Preloaded Image"><img src="assets/img/PREMIUM-BG-EXP.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/PREMIUM-BG.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/pricecheck-thumbnail.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/price-check-plus.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/price-check.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/pricecheck-thumbnail.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/real-time-tracking-dispatches.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/real-time-tracking-map.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/START-BTN-BLANK-HOVER.png" width="1" height="1" alt="Preloaded Image" id="start_hover"><img src="assets/img/START-BTN-BLANK.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/tile.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/user-management.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/user-management-thumb.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/vehicle-inspections-phone-1-start-button.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/vehicle-inspections-phone-1.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/vehicle-inspections-phone-2.png" width="1" height="1" alt="Preloaded Image"><img src="assets/img/vehicle-inspections-phone-3.png" width="1" height="1" alt="Preloaded Image"></div></div>');

$(window).on('load', function(){
  setTimeout(removeLoader, 2000); //wait for page load PLUS two seconds.
});

function removeLoader(){
	//Hide and remove loading screen
    $( "#loading-screen" ).fadeOut(500, function() {
      	// fadeOut complete. Remove the loading div
      	$( "#loading-screen" ).remove(); //makes page more lightweight 
  	});
  	//hide the image loader
  	$( "#image-loader" ).fadeOut(500, function() {
      $( "#image-loader" ).remove(); //leave for now
  	});
}

//SERVICE WORKERR////////////////////////
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker
      .register("/clients/central-dispatch/nada-2025/stg/serviceWorker.js")
      .then(res => console.log("service worker registered"))
      .catch(err => console.log("service worker not registered", err))
  })
}



//FUNCTIONS////////////////////////
function toggleFullScreen() {
  if (!document.fullscreenElement &&    // alternative standard method
      !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen();
      $("#app").addClass("full_screen");
    } else if (document.documentElement.msRequestFullscreen) {
      document.documentElement.msRequestFullscreen();
      $("#app").addClass("full_screen");
    } else if (document.documentElement.mozRequestFullScreen) {
      document.documentElement.mozRequestFullScreen();
      $("#app").addClass("full_screen");
    } else if (document.documentElement.webkitRequestFullscreen) {
      document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
    }
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
      $("#app").removeClass("full_screen");
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
      $("#app").removeClass("full_screen");
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
      $("#app").removeClass("full_screen");
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
      $("#app").removeClass("full_screen");
    }
  }
}

function hideUI() {
    pauseBlur();
 	$('.app_footer').fadeOut();
 	$('.img-overlay').fadeOut();
 	$( '.section, #footer-exit, #footer-menu, .modal, .modal-backdrop' ).each(function(index) {
	   // check section is visible
        if($(this).is(":visible")){
           	$(this).fadeOut().addClass('hide-me');
        } else{
            //do nothing, its hidden
        }
	});
}

function showUI() {
    playUnblur();
 	$('.app_footer').fadeIn();
 	$('.img-overlay').fadeIn();
 	$( '.section, #footer-exit, #footer-menu, .modal, .modal-backdrop' ).each(function(index) {
	   // check if section has opacity lowered
        if($(this).hasClass("hide-me")){
        	$(this).fadeIn().removeClass('hide-me');
        } else{
            //do nothing, its hidden
        }
	});
}




function checkWindow() {
    //check for landscpe or portrait
	var minScreenWidth = 700;
	var screenWidth = $(window).width();
	var screenHeight = $(window).height();
	var aspectRatio = screenHeight / screenWidth;
	var screenMode = '';
	if (screenWidth > screenHeight) {
		console.warn("Alert - Viewport is in Landscape Mode.");
		var screenMode = 'landscape';
		hideUI();
		//show the rotate device screen
		$( '.rotate-msg-overlay' ).fadeIn();
	} else {
		console.log("Alert - Viewport is in Portrait Mode."); 
		var screenMode = 'portrait';
		showUI();
		$( '.rotate-msg-overlay' ).fadeOut();
	}

  // if (aspectRatio < 9 / 16 ) {
  //   // Do something if the aspect ratio is less than 16:9
  //   console.log("Aspect ratio is less than 9:16");
  // } else {
  //   // Do something else if the aspect ratio is 16:9 or greater
  //   console.log("Aspect ratio is 9:16 or greater");
  // }

}

 //Video
let vid = document.getElementById("video_bg");

function playVid() {
    vid.play();
}

function pauseVid() {
    vid.pause();
}

function pauseBlur() {
	$('#video-bg')[0].pause(); 
	$('#video-bg').addClass('blur');
}
function playUnblur(){
	$('#video-bg')[0].play(); 
	$('#video-bg').removeClass('blur');
}
document.onselectstart = new Function("return true");



//SETUP HAMMER JS

var myElement = document.getElementById('app');
var mc = new Hammer(myElement);


$(window).on('resize', function(){
    checkWindow();
}).trigger('resize');


/////////////////////////////////////////////////////////
// START DOC READY  /////////////////////////////////////
/////////////////////////////////////////////////////////

$( document ).ready(function() {
    console.log( "ready!" );
    checkWindow();


	var timer = '';
	var delay = 600000;
	var activityTimeout = setTimeout(inActive, delay);

	//When timer screen 60 sec countdown reaches zero, reset everything and go back to start
	function backtoStart(){
		console.log('backtoStart() was executed.');
		$(document).off('keyup keypress tap taphold click',checkActive);
		$(document).on('keyup keypress tap taphold click',resetActive);	
		clearTimeout(activityTimeout);
	    activityTimeout = setTimeout(inActive, delay);

	    $( '.section' ).each(function(index) {
			if($(this).hasClass("hide-me")){
				$(this).removeClass('hide-me');
			} else{
				//do nothing, its hidden
			}
		});

		$('.dark-overlay').fadeOut();
		$('.img-overlay').fadeIn();
	    playUnblur()
 		$('#start-screen').fadeIn();
 		$('#footer-menu').fadeOut();
 		$('#footer-exit').fadeOut();

	}

	//Activity detected, reset activityTimeout, play video bg, remove blur, set UI elements back to opacity:1
	function resetActive(){
		console.log('resetActive() was executed.');
	    $('#app-container').attr('class', 'app_container active');
	    clearTimeout(activityTimeout);
	    activityTimeout = setTimeout(inActive, delay);
		
	}

	function checkActive() {
		console.log('checkActive() was executed.');
		clearInterval(timer);
		$(document).off('keyup keypress tap taphold click',checkActive);
		$(document).on('keyup keypress tap taphold click',resetActive);	
	}

	// No activity detected.
	function inActive(){
		console.log('inActive() was executed.');
		//unbind when inactive
		$(document).off('keyup keypress tap taphold click',resetActive);
    	$('#app-container').attr('class', 'app_container inactive');
	   
	    //hide UI elements
   		hideUI();

		//show the timer screen
		$( '.timer-overlay' ).fadeIn();

		//Start the clock
		var sec = 60;
		timer = setInterval(function() {
			$('#timer-counter').text(sec--);
		    if (sec == -1) {
		        //reset to start screen
		        console.log('timer ran out.');
		        clearInterval(timer);
		        $('#timer-counter').text('60');
		        $( '.timer-overlay' ).fadeOut();
		        backtoStart();
		    }
		    $("#exit-timer").click(function (e) {
				e.preventDefault();
				console.log('#exit-timer was clicked.');
				clearInterval(timer);
				$('#timer-counter').text('60');
				$( '.timer-overlay' ).fadeOut();
				showUI();
				$(document).off('keyup keypress tap taphold click', checkActive );
				$(document).on('keyup keypress tap taphold click', resetActive );
				$('#footer-exit').fadeIn();
			});

		}, 1000);
	}



	// Check for mousemove, could add other events here such as checking for key presses ect.
	$(document).on('keyup keypress tap taphold click',resetActive);





	$('.modal').on('hide.bs.modal', function (e) {
		//reset modal supporting assets. ex. overlays, extra images, etc..
		//$('.modal-asset').css('display', 'none');

		//Remove Focus
		var previousFocus = document.activeElement;
		// Return focus to that element
		if (previousFocus) {
			previousFocus.focus();
		}
	});

	//Hover Start button
	$("#start-app").hover(function () {
	    $(this).toggleClass("start_hover");
	 });

  	//start the app
	$('#start-app').click(function() {
		console.log( "start btn clicked!" );
		//check for fullscreen
		if ($('body').hasClass('full_screen')) {
			//do nothing
		} else {
			toggleFullScreen();
		}
		$('#start-screen').fadeOut();
		$('.dark-overlay').fadeIn();
		$('#menu-screen').fadeIn();
		$('#footer-exit').fadeIn();
	});
	//Menu Clicks
	$('#manheim-listing-integration').click(function() {
		console.log( "manheim-listing-integration btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#manheim-listing-integration-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#tailored-plans').click(function() {
		console.log( "tailored-plans-screen btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#tailored-plans-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#market-intelligence').click(function() {
		console.log( "market-intelligence btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#market-intelligence-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#carrier-app').click(function() {
		console.log( "carrier-app btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#carrier-app-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#marketplace-apis').click(function() {
		console.log( "marketplace-apis btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#marketplace-apis-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#marketplace-integrity').click(function() {
		console.log( "marketplace-integrity btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#marketplace-integrity-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#about-the-marketplace').click(function() {
		console.log( "about-the-marketplace btn clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#about-the-marketplace-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});
	$('#see-whats-coming').click(function(e) {
		e.preventDefault();
		console.log( "see-whats-coming link clicked!" );
		$('#menu-screen').fadeOut();
	 	window.setTimeout(function(){
	 		pauseBlur();
	 		$('#see-whats-coming-screen').fadeIn();
		 	$('#footer-menu').fadeIn();
	 	},500);
	});

	// $( '.close-screen' ).each(function(index) {
	//     $(this).on('click', function(e){
	//     	e.preventDefault();
	//         // panel to show
	//         var parentContext = $(this).parents('.section');
	        
	//         //animate entrance/exit
	// 	    $('.section', parentContext).removeClass('animate__fadeIn').addClass('animate__fadeOut');
	// 	    $('.modal_frame',parentContext).removeClass('off_stage animate__fadeOutDownBig').addClass('animate__fadeInUp');
		    
	// 	    setTimeout(function() {  
	// 	        $('.section', parentContext).addClass('d-none');
	// 	        $('#video-bg')[0].play(); 
	// 	 		$('#video-bg').removeClass('blur');
	// 	 		$('#menu-screen').removeClass('d-none animate__fadeOut').addClass('animate__fadeIn');
	// 	 		$('#footer-menu').addClass('d-none');
	// 	    }, 200);
	//     });
	// });
	// x-btn
	$( '.x-btn' ).each(function(index) {
	    $(this).on('click', function(e){
	        e.preventDefault();
	       $( '.section' ).each(function(index) {
			   // check section is visible
		        if($(this).is(":visible")){
		           	$(this).fadeOut();
		           	
		        }
			});
			setTimeout(function() {
		    	playUnblur();
		 		$('#menu-screen').fadeIn();
		 		$('#footer-exit').fadeIn();
		 		$('#footer-menu').fadeOut();
		    }, 200);
	    });
	});

	$('#footer-exit').click(function() {
		window.setTimeout(function(){
		 	$( '.section' ).each(function(index) {
			   // check section is visible
		        if($(this).is(":visible")){
		           	$(this).fadeOut();
		        }
			});
		 	$('.dark-overlay').fadeOut();
	 	},100);
	 	window.setTimeout(function(){
	 		playUnblur();
	 		$('#start-screen').fadeIn();
	 		$('#footer-menu').fadeOut();
	 		$('#footer-exit').fadeOut();
	 	},500);
	});
	$('#footer-menu').click(function() {
		$('#footer-menu').fadeOut();
		window.setTimeout(function(){
		 	$( '.section' ).each(function(index) {
			   if($(this).is(":visible")){
		           	$(this).fadeOut();
		        }
			});
	 	},100);
	 	window.setTimeout(function(){
	 		playUnblur();
	 		$('#menu-screen').fadeIn();
	 	},200);
	});

	$('#feature_toggle').click(function() {
		$('#plans').toggleClass('feature_open');
	});

	$( '.drawer-trigger' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.drawer-overlay',parentContext ).fadeIn( 500, function() {}  );
			$( '.pc-hs-1',parentContext ).fadeOut( 500, function() {}  );
			$( '.drawer-img',parentContext ).removeClass('animate__slideOutRight').addClass('animate__slideInRight').toggleClass('d-block d-none');
	    });
	});
	$( '.drawer-overlay, .drawer-img' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.drawer-overlay',parentContext ).fadeOut( 500, function() {}  );
			$( '.pc-hs-1',parentContext ).fadeIn( 500, function() {}  );
			$( '.drawer-img',parentContext ).removeClass('animate__slideInRight').addClass('animate__slideOutRight').toggleClass('d-block d-none');
	    });
	});
	$( '.map-trigger' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.map-overlay',parentContext ).fadeIn( 500, function() {}  );
			$( '.pc-hs-1',parentContext ).fadeOut( 500, function() {}  );
			$( '.map-img',parentContext ).removeClass('animate__slideOutDown').addClass('animate__slideInUp').toggleClass('d-block d-none');
			// window.setTimeout(function(){
		 	// 	$( '.map-img',parentContext ).toggleClass('d-block d-none');
		 	// },500);
	    });
	});
	$( '.map-overlay, .map-img' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.map-overlay',parentContext ).fadeOut( 500, function() {}  );
			$( '.pc-hs-1',parentContext ).fadeIn( 500, function() {}  );
			$( '.map-img',parentContext ).removeClass('animate__slideInUp').addClass('animate__slideOutDown').toggleClass('d-block d-none');
			// window.setTimeout(function(){
		 	// 	$( '.map-img',parentContext ).toggleClass('d-block d-none');
		 	// },500);
	    });
	});

	$( '.listing-trigger' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.listing-overlay',parentContext ).fadeIn( 500, function() {}  );
			$( '.hs-5',parentContext ).fadeOut( 500, function() {}  );
			$( '.listing-img',parentContext ).removeClass('animate__slideOutDown').addClass('animate__slideInUp').toggleClass('d-block d-none');
			// window.setTimeout(function(){
		 	// 	$( '.listing-img',parentContext ).toggleClass('d-block d-none');
		 	// },500);
	    });
	});
	$( '.listing-overlay, .listing-img' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.listing-overlay',parentContext ).fadeOut( 500, function() {}  );
			$( '.hs-5',parentContext ).fadeIn( 500, function() {}  );
			$( '.listing-img',parentContext ).removeClass('animate__slideInUp').addClass('animate__slideOutDown').toggleClass('d-block d-none');
			// window.setTimeout(function(){
		 	// 	$( '.map-img',parentContext ).toggleClass('d-block d-none');
		 	// },500);
	    });
	});
	$( '.blind-ratings-modal-1' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.blind-ratings-modal-2',parentContext ).toggle( "fast", function() {}  );
	    });
	});
	$( '.blind-ratings-modal-2' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $(this).toggle( "fast", function() {}  );
	    });
	});

	$( '.img-toggle' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.top-img',parentContext).toggleClass( "op-0" );
	    });
	});


	$( '.phone-start-button' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	        $( '.phone-img-1',parentContext ).removeClass('op-1').addClass('op-0');
	        $( '.phone-start-button',parentContext ).removeClass('op-1').addClass('op-0');
	        $( '.phone-img-2',parentContext ).removeClass('d-none op-0').addClass('op-1');
	        $( '.hs-4',parentContext ).removeClass('d-none op-0').addClass('op-1');
	        window.setTimeout(function(){
	        	$( '.phone-img-1',parentContext ).addClass('d-none');
	        	$( '.phone-start-button',parentContext ).addClass('d-none');
		 	},200);
	    });
	});
	$( '.phone-img-2' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	    	$( '.phone-img-2',parentContext ).addClass('rotate-90');
	        $( '.phone-img-3',parentContext ).addClass('rotate-90');
	        $( '.hs-4',parentContext ).removeClass('op-1').addClass('op-0');
	        window.setTimeout(function(){
	        	$( '.phone-img-3',parentContext ).removeClass('d-none op-0').addClass('op-1');
	        	$( '.phone-img-2',parentContext ).removeClass('op-1').addClass('op-0');
	        	$( '.phone-img-2',parentContext ).addClass('d-none');
	        	$( '.hs-4',parentContext ).addClass('d-none');
		 	},200);
	    });
	});
	$( '.phone-img-3' ).each(function(index) {
	    $(this).on('click', function(e){
	    	e.preventDefault();
	    	var parentContext = $(this).parents('.modal-body');
	    	$( '.phone-img-3',parentContext ).removeClass('op-1').addClass('op-0');
	        $( '.phone-img-1',parentContext ).removeClass('d-none op-0').addClass('op-1 ');
	        $( '.phone-start-button',parentContext ).removeClass('op-0').addClass('op-1');
	        window.setTimeout(function(){
	        	$( '.phone-img-3',parentContext ).addClass('d-none');
	        	$( '.phone-start-button',parentContext ).removeClass('op-0 d-none').addClass('op-1');
	        	$( '.phone-img-2',parentContext ).removeClass('rotate-90');
	        	$( '.phone-img-3',parentContext ).removeClass('rotate-90');
		 	},200);
	    });
	});


	$('.menu_container #footer-menu').hover (function(){
	  $(this).toggleClass('open');
	});


	//Modal Exit Button - close parent modal
	$('.exit').click(function() {
		console.log( ".exit btn clicked!" );
		exitModal(this);

	});

	function exitModal(modal_item) {
		$(modal_item).parent().closest('.window').removeClass('animate__slideInUp').addClass('animate__fadeOutDownBig');
		$('aside').removeClass('fade_out');
		$('#header').removeClass('fade_out-50');
	    $('#threesixty').removeClass('blur');
	    window.setTimeout( move_off_stage.bind(null, modal_item), 1000 ); // short delay for things to happen
	    $('.cr_hint').addClass('off_stage');
	    $('.zoom_frame').empty();
	    $('.zoom_frame').addClass('off_stage');
	    
	}
	
	//toggleFullScreen
	$('#full_screen_toggle').click(function() {
		toggleFullScreen();
	});


	// listen to events...
	mc.on("panleft panright tap press", function(ev) {
	    //myElement.textContent = ev.type +" gesture detected.";
	    console.log(ev.type +" gesture detected.");
	});

	//HELPERS

	function move_off_stage(modal_item){
		$(modal_item).parent().closest('.window').removeClass('active_window animate__fadeOutUpBig').addClass('off_stage');
	};
	

});
/////////////////////////////////////////////////////////
// END DOC READY  ///////////////////////////////////////
/////////////////////////////////////////////////////////